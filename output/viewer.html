<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lead Scout - Results Viewer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #e4e4e4;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      padding: 40px 20px;
      margin-bottom: 30px;
    }

    header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #00d4ff, #7b2cbf);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 10px;
    }

    header p {
      color: #888;
      font-size: 1.1rem;
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 30px 0;
      flex-wrap: wrap;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px 40px;
      text-align: center;
    }

    .stat-card .number {
      font-size: 2.5rem;
      font-weight: 700;
      color: #00d4ff;
    }

    .stat-card .label {
      color: #888;
      font-size: 0.9rem;
      margin-top: 5px;
    }

    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .search-box {
      flex: 1;
      max-width: 400px;
      position: relative;
    }

    .search-box input {
      width: 100%;
      padding: 12px 20px 12px 45px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      font-size: 1rem;
    }

    .search-box input::placeholder {
      color: #666;
    }

    .search-box::before {
      content: "üîç";
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
    }

    select {
      padding: 12px 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
    }

    select option {
      background: #1a1a2e;
    }

    .leads-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
      gap: 20px;
    }

    .lead-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 24px;
      transition: all 0.3s ease;
    }

    .lead-card:hover {
      transform: translateY(-4px);
      border-color: rgba(0, 212, 255, 0.3);
      box-shadow: 0 10px 40px rgba(0, 212, 255, 0.1);
    }

    .lead-header {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 16px;
    }

    .avatar {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      font-weight: 600;
      color: #fff;
      flex-shrink: 0;
      overflow: hidden;
      background: #444;
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-initials {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lead-info {
      flex: 1;
      min-width: 0;
    }

    .lead-info h3 {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 4px;
      color: #fff;
    }

    .lead-info h3 a {
      color: #4a9eff;
      text-decoration: none;
    }

    .lead-info h3 a:hover {
      text-decoration: underline;
    }

    .lead-info .role {
      color: #00d4ff;
      font-size: 0.95rem;
      margin-bottom: 2px;
    }

    .lead-info .company {
      color: #888;
      font-size: 0.9rem;
    }

    .lead-meta {
      display: flex;
      gap: 10px;
      margin: 16px 0;
      flex-wrap: wrap;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .badge.high {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .badge.medium {
      background: rgba(234, 179, 8, 0.2);
      color: #eab308;
    }

    .badge.low {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .badge.company-badge {
      background: rgba(139, 92, 246, 0.2);
      color: #a78bfa;
    }

    .badge.topic-badge {
      background: rgba(0, 212, 255, 0.2);
      color: #00d4ff;
    }

    .snippet {
      color: #aaa;
      font-size: 0.9rem;
      line-height: 1.6;
      margin: 12px 0;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      border-left: 3px solid #444;
    }

    /* Highlighted keywords in snippet - Google style */
    .snippet b, .snippet strong {
      color: #fff;
      font-weight: 600;
      background: rgba(0, 212, 255, 0.15);
      padding: 1px 4px;
      border-radius: 3px;
    }

    .lead-actions {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }

    .btn {
      flex: 1;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      text-decoration: none;
      text-align: center;
      transition: all 0.2s ease;
      cursor: pointer;
      border: none;
    }

    .btn-primary {
      background: linear-gradient(90deg, #0077b5, #00a0dc);
      color: #fff;
    }

    .btn-primary:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 15px rgba(0, 119, 181, 0.4);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #ccc;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .no-results h3 {
      font-size: 1.5rem;
      margin-bottom: 10px;
      color: #888;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #888;
    }

    .error {
      text-align: center;
      padding: 40px 20px;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 12px;
      margin: 20px 0;
    }

    .error h3 {
      color: #ef4444;
      margin-bottom: 10px;
    }

    .error p {
      color: #888;
    }

    .error code {
      display: block;
      margin-top: 15px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      font-size: 0.85rem;
      color: #ccc;
    }

    footer {
      text-align: center;
      padding: 40px 20px;
      color: #555;
      font-size: 0.9rem;
    }

    .no-image {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    @media (max-width: 768px) {
      header h1 {
        font-size: 1.8rem;
      }

      .stats {
        gap: 20px;
      }

      .stat-card {
        padding: 15px 25px;
      }

      .leads-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üéØ Lead Scout</h1>
      <p>LinkedIn X-Ray Search Results</p>
    </header>

    <div class="stats" id="stats">
      <div class="stat-card">
        <div class="number" id="total-leads">-</div>
        <div class="label">Total Leads</div>
      </div>
      <div class="stat-card">
        <div class="number" id="companies-count">-</div>
        <div class="label">Companies</div>
      </div>
      <div class="stat-card">
        <div class="number" id="high-confidence">-</div>
        <div class="label">High Confidence</div>
      </div>
      <div class="stat-card">
        <div class="number" id="with-photos">-</div>
        <div class="label">With Photos</div>
      </div>
    </div>

    <div class="controls">
      <div class="search-box">
        <input type="text" id="search" placeholder="Search by name, role, or company...">
      </div>
      <select id="company-filter">
        <option value="">All Companies</option>
      </select>
      <select id="confidence-filter">
        <option value="">All Confidence</option>
        <option value="high">High</option>
        <option value="medium">Medium</option>
        <option value="low">Low</option>
      </select>
      <select id="sort-by">
        <option value="date-desc">Newest First</option>
        <option value="date-asc">Oldest First</option>
        <option value="name-asc">Name A-Z</option>
        <option value="name-desc">Name Z-A</option>
        <option value="company-asc">Company A-Z</option>
      </select>
    </div>

    <div id="content">
      <div class="loading">Loading leads...</div>
    </div>

    <footer>
      <p>Lead Scout - Module A: Google X-Ray Search</p>
    </footer>
  </div>

  <script>
    // Color palette for avatars based on company name
    const colors = [
      '#e74c3c', '#9b59b6', '#3498db', '#1abc9c', '#2ecc71',
      '#f39c12', '#e67e22', '#16a085', '#8e44ad', '#2980b9',
      '#27ae60', '#d35400', '#c0392b', '#7f8c8d', '#34495e'
    ];

    function getColorForName(name) {
      let hash = 0;
      for (let i = 0; i < name.length; i++) {
        hash = name.charCodeAt(i) + ((hash << 5) - hash);
      }
      return colors[Math.abs(hash) % colors.length];
    }

    function getInitials(name) {
      return name
        .split(' ')
        .map(n => n[0])
        .join('')
        .toUpperCase()
        .slice(0, 2);
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function createLeadCard(lead) {
      const color = getColorForName(lead.name);
      const initials = getInitials(lead.name);

      // Use profile image if available, otherwise show initials
      const avatarContent = lead.imageUrl
        ? `<img src="${escapeHtml(lead.imageUrl)}" alt="${escapeHtml(lead.name)}" onerror="this.parentElement.innerHTML='<div class=\\'avatar-initials\\' style=\\'background:${color}\\'>${initials}</div>'">`
        : `<div class="avatar-initials" style="background:${color}">${initials}</div>`;

      // Use htmlSnippet if available (has <b> tags for highlighting), otherwise plain snippet
      const snippetHtml = lead.htmlSnippet || escapeHtml(lead.snippet || '');

      return `
        <div class="lead-card" data-company="${escapeHtml(lead.company)}" data-confidence="${lead.confidence}" data-name="${escapeHtml(lead.name)}" data-date="${lead.discoveredAt}">
          <div class="lead-header">
            <div class="avatar ${lead.imageUrl ? '' : 'no-image'}">
              ${avatarContent}
            </div>
            <div class="lead-info">
              <h3><a href="${escapeHtml(lead.linkedinUrl)}" target="_blank" rel="noopener">${escapeHtml(lead.name)}</a></h3>
              <div class="role">${escapeHtml(lead.role)}</div>
              <div class="company">${escapeHtml(lead.company)}</div>
            </div>
          </div>
          <div class="lead-meta">
            <span class="badge ${lead.confidence}">${lead.confidence} confidence</span>
            <span class="badge company-badge">${escapeHtml(lead.company)}</span>
            ${(lead.matchedTopics || []).map(topic => `<span class="badge topic-badge">${escapeHtml(topic)}</span>`).join('')}
          </div>
          ${snippetHtml ? `<div class="snippet">${snippetHtml}</div>` : ''}
          <div class="lead-actions">
            <a href="${escapeHtml(lead.linkedinUrl)}" target="_blank" rel="noopener" class="btn btn-primary">
              View on LinkedIn
            </a>
            <button class="btn btn-secondary" onclick="copyToClipboard('${escapeHtml(lead.linkedinUrl)}')">
              Copy Link
            </button>
          </div>
        </div>
      `;
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // Brief visual feedback could be added here
        alert('Link copied to clipboard!');
      });
    }

    let allLeads = [];

    function renderLeads(leads) {
      const content = document.getElementById('content');

      if (leads.length === 0) {
        content.innerHTML = `
          <div class="no-results">
            <h3>No leads found</h3>
            <p>Try adjusting your search or filters</p>
          </div>
        `;
        return;
      }

      content.innerHTML = `
        <div class="leads-grid">
          ${leads.map(createLeadCard).join('')}
        </div>
      `;
    }

    function updateStats(leads) {
      document.getElementById('total-leads').textContent = leads.length;

      const companies = new Set(leads.map(l => l.company));
      document.getElementById('companies-count').textContent = companies.size;

      const highConfidence = leads.filter(l => l.confidence === 'high').length;
      document.getElementById('high-confidence').textContent = highConfidence;

      const withPhotos = leads.filter(l => l.imageUrl).length;
      document.getElementById('with-photos').textContent = withPhotos;
    }

    function populateCompanyFilter(leads) {
      const companies = [...new Set(leads.map(l => l.company))].sort();
      const select = document.getElementById('company-filter');

      companies.forEach(company => {
        const option = document.createElement('option');
        option.value = company;
        option.textContent = company;
        select.appendChild(option);
      });
    }

    function filterAndSort() {
      const searchTerm = document.getElementById('search').value.toLowerCase();
      const companyFilter = document.getElementById('company-filter').value;
      const confidenceFilter = document.getElementById('confidence-filter').value;
      const sortBy = document.getElementById('sort-by').value;

      let filtered = allLeads.filter(lead => {
        const matchesSearch = !searchTerm ||
          lead.name.toLowerCase().includes(searchTerm) ||
          lead.role.toLowerCase().includes(searchTerm) ||
          lead.company.toLowerCase().includes(searchTerm) ||
          (lead.snippet && lead.snippet.toLowerCase().includes(searchTerm));

        const matchesCompany = !companyFilter || lead.company === companyFilter;
        const matchesConfidence = !confidenceFilter || lead.confidence === confidenceFilter;

        return matchesSearch && matchesCompany && matchesConfidence;
      });

      // Sort
      filtered.sort((a, b) => {
        switch (sortBy) {
          case 'date-desc':
            return new Date(b.discoveredAt) - new Date(a.discoveredAt);
          case 'date-asc':
            return new Date(a.discoveredAt) - new Date(b.discoveredAt);
          case 'name-asc':
            return a.name.localeCompare(b.name);
          case 'name-desc':
            return b.name.localeCompare(a.name);
          case 'company-asc':
            return a.company.localeCompare(b.company);
          default:
            return 0;
        }
      });

      renderLeads(filtered);
    }

    // Load leads from JSON file
    async function loadLeads() {
      try {
        const response = await fetch('leads.json');

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        allLeads = await response.json();

        if (!Array.isArray(allLeads)) {
          throw new Error('Invalid data format: expected an array');
        }

        updateStats(allLeads);
        populateCompanyFilter(allLeads);
        renderLeads(allLeads);

        // Add event listeners for filtering
        document.getElementById('search').addEventListener('input', filterAndSort);
        document.getElementById('company-filter').addEventListener('change', filterAndSort);
        document.getElementById('confidence-filter').addEventListener('change', filterAndSort);
        document.getElementById('sort-by').addEventListener('change', filterAndSort);

      } catch (error) {
        document.getElementById('content').innerHTML = `
          <div class="error">
            <h3>Could not load leads</h3>
            <p>Make sure leads.json is in the same folder as this HTML file.</p>
            <code>Error: ${escapeHtml(error.message)}</code>
            <p style="margin-top: 20px; color: #888;">
              <strong>Tip:</strong> If you're opening this file directly in a browser,
              you may need to serve it via a local server due to CORS restrictions:
              <code style="display: block; margin-top: 10px;">npm run view</code>
              Then open http://localhost:3000/viewer.html
            </p>
          </div>
        `;
      }
    }

    // Initialize
    loadLeads();
  </script>
</body>
</html>
